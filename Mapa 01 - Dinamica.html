<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Unidades Geomorfol√≥gicas</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 350px;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.4em;
            font-weight: bold;
        }
        
        .header p {
            margin: 8px 0 0 0;
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .legend {
            padding: 20px;
        }
        
        .legend h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
            font-size: 1.1em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .legend-item:hover {
            background-color: #f7fafc;
        }
        
        .legend-color {
            width: 25px;
            height: 20px;
            border-radius: 3px;
            margin-right: 12px;
            border: 1px solid #cbd5e0;
            flex-shrink: 0;
        }
        
        .legend-text {
            flex: 1;
        }
        
        .legend-label {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.85em;
            line-height: 1.2;
        }
        
        .legend-percent {
            color: #718096;
            font-size: 0.8em;
            margin-top: 2px;
        }
        
        .controls {
            padding: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .btn {
            background: #4a5568;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 0.85em;
            transition: background-color 0.2s;
        }
        
        .btn:hover {
            background: #2d3748;
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        .file-input input {
            width: 100%;
            padding: 8px;
            border: 2px dashed #cbd5e0;
            border-radius: 4px;
            background: #f7fafc;
        }
        
        #map {
            flex: 1;
            height: 100vh;
        }
        
        .info-box {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid #4a5568;
            font-size: 0.85em;
        }
        
        .leaflet-popup-content {
            font-family: Arial, sans-serif;
        }
        
        .popup-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .popup-info {
            color: #4a5568;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="header">
                <h1>Unidades Geomorfol√≥gicas</h1>
                <p>Bacia do Rio Pindar√©</p>
            </div>
            
            <div class="legend">
                <h3>Legenda</h3>
                <div id="legend-items">
                    <!-- Legenda ser√° preenchida dinamicamente -->
                </div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="ajustarVista()">üó∫Ô∏è Ajustar Vista</button>
                <button class="btn" onclick="alternarCamada()">üé® Alterar Mapa</button>
                <button class="btn" onclick="exportarDados()">üíæ Exportar</button>
                
                <div class="info-box" id="status-info">
                    <strong>üîÑ Conectando ao GitHub...</strong><br>
                    Carregando brunnosilllva/Dinamica
                </div>
            </div>
        </div>
        
        <div id="map"></div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Configura√ß√£o do mapa
        let map = L.map('map').setView([-3.5, -45.0], 8);
        
        // Camadas de mapa
        let mapLayers = {
            openStreetMap: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }),
            satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri'
            }),
            terrain: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenTopoMap'
            })
        };
        
        let currentLayer = 'openStreetMap';
        mapLayers[currentLayer].addTo(map);
        
        // Vari√°veis globais
        let geojsonLayer = null;
        let unidadesData = [];
        
        // Cores para as unidades geomorfol√≥gicas
        const coresUnidades = {
            'R1d - Plan√≠cies fluviomarinhas': '#87CEEB',
            'R3a2 - Superf√≠cies aplainadas degradadas': '#DAA520', 
            'R4a1 - Dom√≠nio de colinas amplas e suaves': '#F08080',
            'R2b3 - Planaltos': '#8B4513',
            'R4b - Dom√≠nio de morros e serras baixas': '#A0522D',
            'R2b2 - Baixos plat√¥s dissecados': '#F5DEB3',
            'R4f - Vales encaixados': '#2E8B57',
            'R2b1 - Baixos plat√¥s': '#FF8C00',
            'R4e - Degraus estruturais e rebordos erosivos': '#FF6347',
            'R4a2 - Dom√≠nio de colinas dissecadas e de morros baixos': '#DDA0DD',
            'R1a - Plan√≠cies fluviais ou fl√∫vio-lacustres': '#90EE90'
        };
        
        // Percentuais das unidades (baseado na imagem)
        const percentuaisUnidades = {
            'R1d - Plan√≠cies fluviomarinhas': '1,65%',
            'R3a2 - Superf√≠cies aplainadas degradadas': '18,68%',
            'R4a1 - Dom√≠nio de colinas amplas e suaves': '7,67%',
            'R2b3 - Planaltos': '11,09%',
            'R4b - Dom√≠nio de morros e serras baixas': '10,33%',
            'R2b2 - Baixos plat√¥s dissecados': '20,10%',
            'R4f - Vales encaixados': '11,74%',
            'R2b1 - Baixos plat√¥s': '3,42%',
            'R4e - Degraus estruturais e rebordos erosivos': '1%',
            'R4a2 - Dom√≠nio de colinas dissecadas e de morros baixos': '10,79%',
            'R1a - Plan√≠cies fluviais ou fl√∫vio-lacustres': '2,18%'
        };
        
        // Fun√ß√£o para obter cor da unidade
        function obterCor(nomeUnidade) {
            return coresUnidades[nomeUnidade] || '#808080';
        }
        
        // Fun√ß√£o para estilizar as features
        function estilizarFeature(feature) {
            const nomeUnidade = feature.properties.nome || feature.properties.NOME || 
                              feature.properties.unidade || feature.properties.UNIDADE ||
                              'Unidade n√£o identificada';
            
            return {
                fillColor: obterCor(nomeUnidade),
                weight: 1,
                opacity: 0.8,
                color: '#333333',
                fillOpacity: 0.7
            };
        }
        
        // Fun√ß√£o para criar popup
        function criarPopup(feature, layer) {
            const props = feature.properties;
            const nomeUnidade = props.nome || props.NOME || props.unidade || props.UNIDADE || 'N√£o identificada';
            const percentual = percentuaisUnidades[nomeUnidade] || 'N/A';
            
            let popupContent = `
                <div class="popup-title">${nomeUnidade}</div>
                <div class="popup-info">
                    <strong>Percentual:</strong> ${percentual}<br>
                    <strong>Tipo:</strong> Unidade Geomorfol√≥gica
                </div>
            `;
            
            // Adicionar outras propriedades se existirem
            Object.keys(props).forEach(key => {
                if (key !== 'nome' && key !== 'NOME' && key !== 'unidade' && key !== 'UNIDADE') {
                    popupContent += `<br><strong>${key}:</strong> ${props[key]}`;
                }
            });
            
            layer.bindPopup(popupContent);
        }
        
        // Fun√ß√£o para criar a legenda
        function criarLegenda() {
            const legendContainer = document.getElementById('legend-items');
            legendContainer.innerHTML = '';
            
            Object.entries(coresUnidades).forEach(([unidade, cor]) => {
                const percentual = percentuaisUnidades[unidade] || '0%';
                
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-color" style="background-color: ${cor}"></div>
                    <div class="legend-text">
                        <div class="legend-label">${unidade}</div>
                        <div class="legend-percent">${percentual}</div>
                    </div>
                `;
                
                legendContainer.appendChild(legendItem);
            });
        }
        
        // Fun√ß√£o para carregar GeoJSON
        function carregarGeoJSON(geojsonData) {
            try {
                // Remover camada anterior se existir
                if (geojsonLayer) {
                    map.removeLayer(geojsonLayer);
                }
                
                // Criar nova camada GeoJSON
                geojsonLayer = L.geoJSON(geojsonData, {
                    style: estilizarFeature,
                    onEachFeature: criarPopup
                }).addTo(map);
                
                // Ajustar vista para mostrar todos os dados
                map.fitBounds(geojsonLayer.getBounds());
                
                console.log('GeoJSON carregado com sucesso!');
                
            } catch (error) {
                console.error('Erro ao carregar GeoJSON:', error);
                alert('Erro ao carregar o arquivo GeoJSON. Verifique o formato do arquivo.');
            }
        }
        
        // Carregar automaticamente do GitHub
        async function carregarArquivoAutomatico() {
            const statusInfo = document.getElementById('status-info');
            
            try {
                statusInfo.innerHTML = '<strong>üîÑ Carregando do GitHub...</strong><br>Acessando brunnosilllva/Dinamica';
                
                // URL do arquivo no GitHub (raw)
                const githubUrl = 'https://raw.githubusercontent.com/brunnosilllva/Dinamica/main/Geomorf_Pindar√©.geojson';
                
                const response = await fetch(githubUrl);
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status} - ${response.statusText}`);
                }
                
                const geojsonData = await response.json();
                
                carregarGeoJSON(geojsonData);
                
                statusInfo.innerHTML = `
                    <strong>‚úÖ Dados carregados do GitHub!</strong><br>
                    ‚Ä¢ ${geojsonData.features ? geojsonData.features.length : 0} unidades carregadas<br>
                    ‚Ä¢ Clique nas √°reas para detalhes<br>
                    ‚Ä¢ Use os controles para navegar
                `;
                
            } catch (error) {
                console.error('Erro ao carregar do GitHub:', error);
                statusInfo.innerHTML = `
                    <strong>‚ùå Erro ao carregar do GitHub</strong><br>
                    Verifique se o reposit√≥rio brunnosilllva/Dinamica<br>
                    est√° p√∫blico e o arquivo existe<br>
                    <small>Erro: ${error.message}</small>
                `;
            }
        }
        
        // Fun√ß√µes dos bot√µes
        function ajustarVista() {
            if (geojsonLayer) {
                map.fitBounds(geojsonLayer.getBounds());
            }
        }
        
        function alternarCamada() {
            map.removeLayer(mapLayers[currentLayer]);
            
            if (currentLayer === 'openStreetMap') {
                currentLayer = 'satellite';
            } else if (currentLayer === 'satellite') {
                currentLayer = 'terrain';
            } else {
                currentLayer = 'openStreetMap';
            }
            
            mapLayers[currentLayer].addTo(map);
        }
        
        function exportarDados() {
            if (geojsonLayer) {
                const dataStr = JSON.stringify(geojsonLayer.toGeoJSON(), null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = 'unidades_geomorfologicas_exportado.geojson';
                link.click();
                
                URL.revokeObjectURL(url);
            } else {
                alert('Nenhum dado carregado para exportar.');
            }
        }
        
        // Inicializar mapa e carregar dados automaticamente
        criarLegenda();
        carregarArquivoAutomatico();
        
        // Adicionar controles do mapa
        L.control.scale({
            imperial: false,
            metric: true,
            position: 'bottomright'
        }).addTo(map);
        
        console.log('Mapa inicializado. Tentando carregar Geomorf_Pindar√©.geojson automaticamente...');
    </script>
</body>
</html>
